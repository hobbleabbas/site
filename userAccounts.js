function _createForOfIteratorHelper(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);function s(){}var a=0;return{s:s,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,r=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return n=t.done,t},e:function(t){r=!0,o=t},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw o}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var SUCCESS_MESSAGE_DELAY=1e3,AUTH_STATE_DELAY=1e3,LOADING_SCREEN_DELAY=500,LOGGING_ENABLED=!1,App={user:null,userData:{},stagedDataForDatabase:{},signup:function(t){this.stagedDataForDatabase={"practitioner-type":t["practitioner-type"]},firebase.auth().createUserWithEmailAndPassword(t.email,t.password).catch(this.displayError.bind(this))},signin:function(t){var e=t.checkbox?firebase.auth.Auth.Persistence.LOCAL:firebase.auth.Auth.Persistence.SESSION;firebase.auth().setPersistence(e).then(function(){firebase.auth().signInWithEmailAndPassword(t.email,t.password).catch(this.displayError.bind(this))}.bind(this)).catch(this.displayError.bind(this))},signinGoogle:function(){log("Signing user in with Google Auth provider.");var t=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithPopup(t).then(function(t){this.user=t.user}.bind(this)).catch(this.displayError.bind(this))},signout:function(){firebase.auth().signOut(),redirectToHome()},displayError:function(t){this.$success.toggle(!1),this.$error.text(t.message||t).toggle(!0)},displaySuccess:function(t){this.$error.toggle(!1),this.$success.text(t).toggle(!0)},isProfilePage:function(){return"/profile/user-profile"===location.pathname},isAccountSettingsPage:function(){return"/profile/account-settings/account-settings"===location.pathname},isSigninPage:function(){return!!this.signinForm},isSignupPage:function(){return!!this.signupForm},updateUserDataLocal:function(i){log("Adding the following to user's local data store..."),log(i),Object.keys(i).forEach(function(t){var e=i[t];this.userData[t]=e}.bind(this)),this.loadPageData()},putFileInStorage:function(t,e){var i=firebase.storage().ref(),s="avatars/".concat(this.user.uid),a=i.child(s);a.put(t).then(function(t){a.getDownloadURL().then(function(t){this.putDataInDatabase({photoURL:t},e)}.bind(this)).catch(logError)}.bind(this)).catch(logError)},putDataInDatabase:function(t,e){this.updateUserDataLocal(t);var i=firebase.database().ref("users/"+this.user.uid);log("Updating database with the following data..."),log(this.userData),i.set(this.userData,function(t){t?logError(t):e&&e()}.bind(this))},waitOnDatabaseTransfer:function(){},getDataFromDatabaseAndLoadPageData:function(){firebase.database().ref("users/"+this.user.uid).once("value").then(function(t){this.userData=t.val()||{},this.pullNameAndPhotoFromFirebaseProfile(),this.loadPageData()}.bind(this)).catch(logError)},pullNameAndPhotoFromFirebaseProfile:function(){var t,e=this.userData,i=this.user;e["first-name"]||e["last-name"]||!i.displayName||(t=i.displayName.split(" "),e["first-name"]=t.shift(),e["last-name"]=t.join(" ")),e.photoURL||(e.photoURL=i.photoURL),e["contact-email"]||(e["contact-email"]=i.email)},setAuthStateListener:function(){firebase.auth().onAuthStateChanged(function(t){var e;this.user=t,0!==Object.keys(this.stagedDataForDatabase).length?(e=this.stagedDataForDatabase,this.stagedDataForDatabase={},this.putDataInDatabase(e,this.handleAuthState.bind(this))):this.handleAuthState()}.bind(this))},handleAuthState:function(){this.user?(this.toggleNavWhenUserLoggedIn(),this.getDataFromDatabaseAndLoadPageData()):this.toggleNavWhenUserLoggedOut(),this.authGuard()},hideLoadingScreen:function(){setTimeout(function(){scrollToTop(),this.$loadingScreenTop.animate({top:-window.innerHeight},LOADING_SCREEN_DELAY,function(){this.$loadingScreenTop.toggle(!1)}.bind(this)),this.$loadingScreenBottom.animate({top:window.innerHeight},LOADING_SCREEN_DELAY,function(){this.$loadingScreenBottom.toggle(!1)}.bind(this))}.bind(this),0)},authGuard:function(){(this.isSigninPage()||this.isSignupPage())&&this.user?redirectToProfile():this.isProfilePage()&&!this.user&&redirectToHome()},toggleNavWhenUserLoggedIn:function(){this.$navLoginButton.toggle(!1),this.$navProfileButton.toggle(!0)},toggleNavWhenUserLoggedOut:function(){this.$navProfileButton.toggle(!1),this.$navLoginButton.toggle(!0)},setProfileNavName:function(){this.$navProfileButton.text(this.userData["first-name"]||"Profile")},loadPageData:function(){this.setProfileNavName(),this.isProfilePage()?(this.loadProfileNav(),this.loadProfileHeader(),this.loadProfileAbout(),this.loadProfileEdit()):this.isAccountSettingsPage()&&(this.loadProfileNav(),this.loadAccountInfo()),this.hideLoadingScreen()},loadProfileNav:function(){this.loadNavAvatar(),this.loadNavName()},loadProfileHeader:function(){var t=this.userData,e=((t["first-name"]||"")+" "+(t["last-name"]||"")).trim(),i=e?"Hello there, ".concat(e):"Hello there!";this.$welcomeHeading.text(i),this.$usernameHeader.text(e),this.loadAvatar()},loadProfileAbout:function(){var s=this.userData;Object.keys(this.userData).forEach(function(t){var e=s[t],i=document.getElementById("about-"+t);i&&e&&(i.textContent=e)})},loadProfileEdit:function(){var s=this.userData;Object.keys(s).forEach(function(t){var e=s[t],i=document.getElementById("edit-"+t);i&&e&&(i.value=e)})},loadAvatar:function(){var t=this.userData;t&&this.$userAvatar.attr("src",t.photoURL)},loadNavAvatar:function(){var t=this.userData.photoURL;t?this.$profileAvatarButton.css({"background-image":"url("+t+")","background-position":"center"}):this.$profileAvatarButton.toggle(!1)},loadNavName:function(){var t=this.userData["first-name"];t&&this.$profileNameButton.text(t)},loadAccountInfo:function(){this.$accountEmail.text(this.user.email)},bindElements:function(){this.$navLoginButton=$("#nav-login-button"),this.$navProfileButton=$("#nav-profile-button"),this.$formError=$("#form-error-message").toggle(!1),this.$error=$(".error-message"),this.$success=$(".success-message"),this.signupForm=document.getElementById("signupForm"),this.$signupAgreeToTermsCheckbox=$("#sigupCheckbox"),this.signinForm=document.getElementById("signinForm"),this.$signinGoogleButton=$("#signin-google-button"),this.$signinRememberMeCheckbox=$("#signinCheckbox"),this.$forgotPasswordLink=$("#forgotPasswordLink"),this.$profileAvatarButton=$("#profile-avatar-button"),this.$profileNameButton=$("#profile-name-button"),this.$welcomeHeading=$("#welcome-heading"),this.$backgroundHeaderImage=$("#background-header-image"),this.$editBackgroundImageButton=$("#edit-background-image"),this.$userAvatar=$("#user-avatar"),this.$usernameHeader=$("#username-header"),this.$loadingScreenTop=$("#loading-screen-top"),this.$loadingScreenBottom=$("#loading-screen-bottom"),this.$signoutButton=$(".link-logout"),this.$aboutPhone=$("#about-phone"),this.$aboutContactEmail=$("#about-contact-email"),this.$aboutLocation=$("#about-location"),this.$aboutPosition=$("#about-position"),this.$aboutBio=$("#about-bio"),this.$avatarForm=$("#avatar-form"),this.$editProfileForm=$("#wf-form-profile"),this.$editPhotoUpload=$("#photo-upload"),this.$editFirstName=$("#edit-first-name"),this.$editLastName=$("#edit-last-name"),this.$editLocation=$("#edit-location"),this.$editContactEmail=$("#edit-contact-email"),this.$editPhone=$("#edit-phone"),this.$editFacebookUrl=$("#edit-facebook-url"),this.$editInstagramUrl=$("#edit-instagram-url"),this.$editTwitterUrl=$("#edit-twitter-url"),this.$editBio=$("#edit-bio"),this.$changeEmailButton=$("#change-email-button"),this.$changeEmailModal=$("#email-modal"),this.$changeEmailForm=$("#email-modal-form"),this.$accountEmail=$("#account-email"),this.$resetPassword=$("#account-reset-password-link"),this.$resetPasswordModal=$("#reset-password-modal"),this.$resetPasswordForm=$("#reset-password-modal-form"),this.$updatePasswordForm=$("#update-password-form"),this.$deleteAccountButton=$("#delete-account-button"),this.$deleteAccountModal=$("#delete-account-modal"),this.$deleteAccountConfirm=$("#delete-account-confirm-button")},bindEventListeners:function(){this.isSignupPage()?this.signupForm.addEventListener("submit",this.handleSignup.bind(this),!0):this.isSigninPage()?(this.signinForm.addEventListener("submit",this.handleSignin.bind(this),!0),this.$signinGoogleButton.click(this.handleGoogleSignin.bind(this)),this.$forgotPasswordLink.click(this.handleForgotPasswordReset.bind(this))):this.isProfilePage()?(this.$avatarForm.submit(this.handleAvatarUpload.bind(this)),this.$editProfileForm.submit(this.handleProfileEdit.bind(this))):this.isAccountSettingsPage()&&(this.$changeEmailButton.click(this.showChangeEmailModal.bind(this)),this.$changeEmailForm.get(0).addEventListener("submit",this.handleEmailChange.bind(this),!0),this.$resetPassword.click(this.showResetPasswordModal.bind(this)),this.$resetPasswordForm.submit(this.handleAccountPasswordReset.bind(this)),this.$updatePasswordForm.get(0).addEventListener("submit",this.handleUpdatePassword.bind(this),!0),this.$deleteAccountButton.click(this.showDeleteAccountModal.bind(this)),this.$deleteAccountConfirm.click(this.handleDeleteAccount.bind(this))),this.$signoutButton.click(this.handleSignout.bind(this))},showChangeEmailModal:function(){this.$changeEmailModal.attr("style","").fadeIn()},handleEmailChange:function(t){t.preventDefault(),t.stopPropagation();var e=this.$changeEmailForm.find("#name-3").val(),i=this.$changeEmailForm.find("#name-4").val(),s=firebase.auth.EmailAuthProvider.credential(this.user.email,i);this.$success=this.$changeEmailForm.siblings(".success-message"),this.$error=this.$changeEmailForm.siblings(".error-message"),this.user.reauthenticateWithCredential(s).then(function(){this.user.updateEmail(e).then(function(){this.displaySuccess("Your email address has been updated to "+e),setTimeout(function(){this.$changeEmailModal.fadeOut(),this.$changeEmailForm.get(0).reset(),this.$accountEmail.text(e)}.bind(this),SUCCESS_MESSAGE_DELAY)}.bind(this)).catch(this.displayError.bind(this))}.bind(this)).catch(this.displayError.bind(this))},showResetPasswordModal:function(t){t.preventDefault(),this.$resetPasswordModal.attr("style","").fadeIn()},handleAccountPasswordReset:function(){var t=$("#password-reset-email").val();this.$success=this.$resetPasswordForm.siblings(".success-message"),this.$error=this.$resetPasswordForm.siblings(".error-message"),firebase.auth().sendPasswordResetEmail(t).then(function(){this.displaySuccess("Password reset email sent to "+t),setTimeout(function(){this.$resetPasswordModal.toggle(!1),this.$resetPasswordForm.toggle().get(0).reset(),this.$success.toggle(!1)}.bind(this),SUCCESS_MESSAGE_DELAY)}.bind(this)).catch(this.displayError.bind(this))},handleUpdatePassword:function(t){t.preventDefault(),t.stopPropagation();var e=$("#current-password").val(),i=$("#new-password").val(),s=$("#repeat-password").val(),a=firebase.auth.EmailAuthProvider.credential(this.user.email,e);this.$success=this.$updatePasswordForm.siblings(".success-message"),this.$error=this.$updatePasswordForm.siblings(".error-message"),i===s?this.user.reauthenticateWithCredential(a).then(function(){this.user.updatePassword(i).then(function(){this.$updatePasswordForm.get(0).reset(),this.displaySuccess("Your password has been updated."),setTimeout(function(){this.$success.toggle(!1)}.bind(this),SUCCESS_MESSAGE_DELAY)}.bind(this)).catch(this.displayError.bind(this))}.bind(this)).catch(this.displayError.bind(this)):this.displayError("Passwords do not match.")},handleForgotPasswordReset:function(){var t=$("#email").val();t?firebase.auth().sendPasswordResetEmail(t).then(function(){this.displaySuccess("Password reset email sent to "+t)}.bind(this)).catch(this.displayError.bind(this)):this.displayError("Please enter your email address above and click link again.")},showDeleteAccountModal:function(){this.$deleteAccountModal.attr("style","").fadeIn()},handleDeleteAccount:function(){this.user.delete().then(function(){redirectToHome()}).catch(logError)},handleSignout:function(t){t.preventDefault(),this.signout()},handleSignup:function(t){t.preventDefault(),t.stopPropagation();var e=getFormData(t.currentTarget);this.signup(e)},handleSignin:function(t){t.preventDefault(),t.stopPropagation();var e=getFormData(t.currentTarget);this.signin(e)},handleGoogleSignin:function(t){t.preventDefault(),this.signinGoogle()},handleAvatarUpload:function(t){t.preventDefault();var e=t.currentTarget;this.$success=$(e).siblings(".success-message"),this.$error=$(e).siblings(".error-message");var i=getFormData(e)["photo-upload"];this.putFileInStorage(i)},handleProfileEdit:function(t){t.preventDefault();var e=t.currentTarget,i=getFormData(e);this.$success=$(e).siblings(".success-message"),this.$error=$(e).siblings(".error-message"),this.putDataInDatabase(i,function(){setTimeout(function(){this.$success.toggle(!1),$(e).toggle(!0),scrollToTop()}.bind(this),SUCCESS_MESSAGE_DELAY)}.bind(this))},init:function(){return this.bindElements(),this.bindEventListeners(),this.setAuthStateListener(),this}};function redirect(t){location.pathname!==t&&(log("redirecting from "+location.pathname+" to "+t),location.pathname=t)}function redirectToHome(){redirect("/")}function redirectToProfile(){redirect("profile/user-profile")}function log(t){LOGGING_ENABLED&&console.log(t)}function logError(t){t.code&&t.message?(console.error("Error code: "+t.code),console.error("Error message: "+t.message)):console.error(t)}function scrollToTop(){window.scrollTo(0,0)}function getFormData(t){var e,i={},s=_createForOfIteratorHelper(new FormData(t).entries());try{for(s.s();!(e=s.n()).done;){var a=e.value,o=a[0],n=a[1];i[o]=n}}catch(t){s.e(t)}finally{s.f()}return i}$(function(){window.app=App.init()});
